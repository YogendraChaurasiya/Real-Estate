<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/index_css.css') }}" />
    <!--Google Font-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;800&family=Ubuntu&display=swap" rel="stylesheet">
    <!--Bootstrap CDN-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js" integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N" crossorigin="anonymous"></script>
    <!--Font Awesome CDN-->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous">
    <script defer src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" integrity="sha384-rOA1PnstxnOBLzCLMcre8ybwbTmemjzdNlILg8O7z1lUkLXozs4DHonlDtnE7fpc" crossorigin="anonymous"></script>
    <!-- Bootstrap Script -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.min.js" integrity="sha384-heAjqF+bCxXpCWLa6Zhcp4fu20XoNIA98ecBC1YkdXhszjoejr5y9Q77hIrv8R9i" crossorigin="anonymous"></script>
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.ico') }}" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Owner Page</title>
</head>
<body>
    <h1>Welcome, {{ owner.owner_name }}</h1>

    <h2>Your Information:</h2>
    <ul>
        <li>Name: {{ owner.owner_name }}</li>
        <li>Email: {{ owner.email }}</li>
        <li>Phone: {{ owner.phone }}</li>
    </ul>

    <h2>Your Properties:</h2>
    <ul>
        {% for property in owner_properties %}
            <li>
                <!-- Display all 4 property images -->
                {% for i in range(1, 5) %}
                    {% set image_attr = 'image' ~ i %}
                    {% if getattr(property, image_attr) %}
                        <img src="{{ getattr(property, image_attr) }}" alt="Property Image"><br>
                    {% endif %}
                {% endfor %}
                <strong>Property Name:</strong> {{ property.property_name }}<br>
                <strong>Property Description:</strong> {{ property.property_description }}<br>
                <strong>Property Address:</strong> {{ property.address }}<br>
                <strong>Property Type:</strong> {{ property.property_type }}<br>
                <strong>Price:</strong> {{ property.price }}<br>
                
                <!-- Display scheduled appointments for the property -->
                {% if owner_appointments[property] %}
                    <strong>Scheduled Appointments:</strong><br>
                    <ul>
                        {% for appointment in owner_appointments[property] %}
                            <li>
                                Client: {{ appointment.client_name }}<br>
                                Appointment Date: {{ appointment.appointment_date }}<br>
                                Appointment Time: {{ appointment.appointment_time }}<br>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <strong>No Scheduled Appointments</strong><br>
                {% endif %}
                <!-- Display booking status for the property -->
                {% if booked_properties[property] %}
                    <strong>Property Booked</strong><br>
                    <ul>
                        {% for booking in booked_properties[property] %}
                        <li>
                            {% set client = Client.query.get(booking.cid) %}
                            Booked by: {{ client.name }}<br>
                            Booking Date: {{ booking.booked_date }}<br>
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <strong>Property Not Booked</strong><br>
                {% endif %}
            </li>
        {% endfor %}
    </ul>

    <h2 id="soldPropertiesTitle">Your Sold Properties:</h2>
    <ul id="soldPropertiesList">
        {% for property in sold_properties %}
            <li>
                {% for i in range(1, 5) %}
                    {% set image_attr = 'image' ~ i %}
                    {% if property[image_attr] %}
                        <img src="{{ property[image_attr] }}" alt="Property Image">
                    {% endif %}
                {% endfor %} <br>
                Property Name: {{ property.property_name }}<br>
                Property Sold to: {{ property.current_owner }}<br>
                Property Type: {{ property.property_type }}<br>
                Price: {{ property.price }}<br>
            </li>
        {% endfor %}
    </ul>

    <script>
        // Get the number of owned properties
        var numSoldProperties = {{ properties | length }};

        // Check if the client owns any properties
        if (numSoldProperties === 0) {
            // Hide the "Your Owned Properties" section
            document.getElementById("soldPropertiesTitle").style.display = "none";
            document.getElementById("soldPropertiesList").style.display = "none";
            
            // Display message indicating no owned properties
            var noSoldPropertiesMessage = document.createElement("h2");
            noSoldPropertiesMessage.textContent = "Your no property has been sold yet";
            document.body.appendChild(noSoldPropertiesMessage);
        }
    </script>
</body>
</html>
